<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="None">
        
        
        <link rel="shortcut icon" href="img/favicon.ico">
        <title>Bedrock Configurator</title>
        <link href="css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="css/font-awesome.min.css" rel="stylesheet">
        <link href="css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <link href="css/extra.css" rel="stylesheet">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="js/jquery-1.10.2.min.js" defer></script>
        <script src="js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body class="homepage">

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href=".">Bedrock Configurator</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="active">
                                <a href=".">Home</a>
                            </li>
                            <li >
                                <a href="configs/">Current Configs</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="disabled">
                                <a rel="next" >
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="configs/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/mozmeao/www-config"><i class="fa fa-github"></i> GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#bedrock-configurator">Bedrock Configurator</a></li>
            <li><a href="#quick-start">Quick Start</a></li>
            <li><a href="#how-it-works">How it Works</a></li>
            <li><a href="#editing-the-configs">Editing the Configs</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="bedrock-configurator">Bedrock Configurator</h1>
<p>This is the documentation for the configuration system for <a href="https://github.com/mozilla/bedrock">Bedrock</a> instances. We have two distinct types
of configuration values: static and dynamic. Static configurations are those that are loaded at app startup in
the <code>bedrock/settings/base.py</code> file primarily. They require an app restart to pick up new values and get their
values from either the environment or a .env file in the app root directory.</p>
<p>The second kind of configuration is one that can change while the app is running. At the moment the only use of
these is waffle switches and funnelcake configuration. These can be loaded from the same places as static configs
(environment and .env) but also from the database. So you can continue using your <code>.env</code> file locally to test
settings, but we can distribute said settings to our running instances via the database update process. This is why
we've separated these values into separate files.</p>
<p>Static configurations are stored in the <code>config</code> directory in this repo and can only be updated via a push to the app-name
branch (as described below). The dynamic configs however will automatically roll out after a change is merged to the master
branch.</p>
<h2 id="quick-start">Quick Start</h2>
<h3 id="dynamic-configs">Dynamic Configs</h3>
<p>So you want to flip a waffle switch in production? Great! Do this:</p>
<ol>
<li>Clone the <code>mozmeao/www-config</code> repo.</li>
<li>Fork the repo into your Github account.</li>
<li>Edit the <code>waffle_configs/bedrock-prod.env</code> file to add the name and value you need. You'd add a line like <code>SWITCH_WE_DO_PHRASING=on</code> to set that key and value in the settings database for prod. Or you can find the line that already has the variable you need and change the value if it already exists.</li>
<li>Commit the change.</li>
<li>Push the change to a branch on your fork.</li>
<li>Submit a pull-request against the <code>mozmeao/www-config</code> repo.</li>
<li>Ask for a review in the <code>#www</code> IRC channel or in the PR itself.</li>
<li>Once the PR is reviewed and merged it will automatically roll out to our production instances in 5 to 10 minutes.</li>
</ol>
<h3 id="static-configs">Static Configs</h3>
<p>Let's say you want to change a static config value in prod. Follow the following procedure:</p>
<ol>
<li>Clone the <code>mozmeao/www-config</code> repo.</li>
<li>Fork the repo into your Github account.</li>
<li>Edit the <code>configs/bedrock-prod.env</code> file to add the name and value you need. You'd add a line like <code>STAFF_NAMES=Woodhouse</code> to set that key and value in the environment for prod. Or you can find the line that already has the variable you need and change the value if it already exists.</li>
<li>Commit the change.</li>
<li>Push the change to a branch on your fork.</li>
<li>Submit a pull-request against the <code>mozmeao/www-config</code> repo.</li>
<li>Ask for a review in the <code>#www</code> IRC channel or in the PR itself.</li>
<li>Once the PR is reviewed and merged it can be applied: <code>git pull origin master &amp;&amp; ./set-config bedrock-prod</code>. (This assumes <code>origin</code> is your remote name for the <code>mozmeao</code> repo. If not, set an environmental variable with that name. For example, if you have named your <code>mozmeao</code> remote <code>upstream</code>, you'd run <code>MOZ_GIT_REMOTE=upstream ./set-config bedrock-prod</code>.)</li>
</ol>
<h2 id="how-it-works">How it Works</h2>
<p>This repo is designed to hold the <a href="configs/">non-secret environment variable configuration options</a> for the various instances of <a href="https://github.com/mozilla/bedrock">Bedrock</a>. The idea is that you edit the <code>*.env</code> file associated with the bedrock Deis app you'd like to update (e.g. <code>bedrock-prod.env</code>). This would be submitted as a pull-request to the <code>www-config</code> repo, the PR would then be reviewed and merged to <code>master</code>. Once the config in the <code>master</code> branch was ready to apply, that revision of <code>master</code> would be pushed to a branch named after the Deis app name that needed updating (e.g. <code>bedrock-prod</code>). This would start the process of applying the configuration to our Deis clusters in sequence, and running our <code>headless</code> tests against them in turn.</p>
<p>If the change to be applied needed to be done as quickly as possible, for example if something is broken, you can alternately push <code>master</code> to a similar branch as above but prefixed with <code>fast/</code> (e.g. <code>fast/bedrock-prod</code>). This will do the same thing as above but every Deis cluster will be pushed and tested simultaneously (or in parallel, instead of in series).</p>
<p>There is a script in the repo to help with this called <code>./set-config</code>. It allows you to do the following:</p>
<pre><code class="shell">$ ./set-config bedrock-stage
</code></pre>

<p>This will push your currently checked out revision of the configurations to the app name passed to it. You can also invoke it with <code>-f</code> or <code>--fast</code> and it will cause the configurations to be applied in parallel as mentioned above.</p>
<pre><code class="shell">$ ./set-config -f bedrock-prod
</code></pre>

<h2 id="editing-the-configs">Editing the Configs</h2>
<p>The configurations are in the <code>configs</code> and <code>waffle_configs</code> directories in the repo. They are simple environment files in the <a href="https://ddollar.github.io/foreman/#ENVIRONMENT">format usable by Foreman</a>. The final list of variables to apply for static values will be the mix of 3 possible files.</p>
<ol>
<li><code>configs/global.env</code>: applied to every app.</li>
<li><code>configs/{cluster-name}.env</code>: applied to every app in <code>{cluster-name}</code> (e.g. <code>frankfurt</code>). See <code>jenkins/regions.yml</code> for more on the clusters.</li>
<li><code>configs/{app-name}.env</code>: applied to the app named for the file in every cluster.</li>
</ol>
<p>You'll almost always only need to edit the file for a particular app, but the others are available should you need them.</p>
<p>You can also delete a static environment variable from an app. Simply set the value of the variable to nothing or whitespace:</p>
<pre><code class="bash"># configs to set
DUDE=Abides

# configs to delete
WALTER=
</code></pre>

<p>In the above example, if the app had <code>WALTER=bowling</code> set, then this would remove the <code>WALTER</code> environment variable from the app
via the <code>deis config:unset</code> command. It is recommended to keep deleted variables grouped together at the bottom of the env files.</p>
<p>Deleting a dynamic value (those in the <code>waffle_config</code> directory) is simply deleting the line from the file. The full list of configurations are refreshed every time for those values.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = ".",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="js/base.js" defer></script>
        <script src="search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>

<!--
MkDocs version : 1.0.4
Build Date UTC : 2019-10-24 12:39:18
-->
